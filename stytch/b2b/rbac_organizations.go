package b2b

// !!!
// WARNING: This file is autogenerated
// Only modify code within MANUAL() sections
// or your changes may be overwritten later!
// !!!

import (
	"context"
	"encoding/json"
	"fmt"
	"net/url"

	"github.com/stytchauth/stytch-go/v17/stytch"
	"github.com/stytchauth/stytch-go/v17/stytch/b2b/rbac/organizations"
	"github.com/stytchauth/stytch-go/v17/stytch/stytcherror"
)

type RBACOrganizationsClient struct {
	C stytch.Client
}

func NewRBACOrganizationsClient(c stytch.Client) *RBACOrganizationsClient {
	return &RBACOrganizationsClient{
		C: c,
	}
}

// GetOrgPolicy:
// The organization RBAC policy feature is currently in private beta and must be enabled for your
// Workspace. Please contact Stytch support at support@stytch.com to request access.
//
// Get the active RBAC Policy for a specific Organization within your Stytch Project. An Organization RBAC
// Policy contains the roles that have been defined specifically for that organization, allowing for
// organization-specific permissioning models.
//
// This endpoint returns the organization-scoped roles that supplement the project-level RBAC policy.
// Organization policies allow you to define custom roles that are specific to individual organizations
// within your project.
//
// When using the backend SDKs, the RBAC Policy will be cached to allow for local evaluations, eliminating
// the need for an extra request to Stytch. The policy will be refreshed if an authorization check is
// requested and the RBAC policy was last updated more than 5 minutes ago.
//
// Organization-specific roles can be created and managed through this API endpoint, providing fine-grained
// control over permissions at the organization level.
//
// Check out the [RBAC overview](https://stytch.com/docs/b2b/guides/rbac/overview) to learn more about
// Stytch's RBAC permissioning model and organization-scoped policies.
func (c *RBACOrganizationsClient) GetOrgPolicy(
	ctx context.Context,
	body *organizations.GetOrgPolicyParams,
) (*organizations.GetOrgPolicyResponse, error) {
	headers := make(map[string][]string)

	var retVal organizations.GetOrgPolicyResponse
	err := c.C.NewRequest(
		ctx,
		stytch.RequestParams{
			Method:      "GET",
			Path:        fmt.Sprintf("/v1/b2b/rbac/organizations/%s", url.PathEscape(body.OrganizationID)),
			QueryParams: nil,
			Body:        nil,
			V:           &retVal,
			Headers:     headers,
		},
	)
	return &retVal, err
}

// SetOrgPolicy:
// The organization RBAC policy feature is currently in private beta and must be enabled for your
// Workspace. Please contact Stytch support at support@stytch.com to request access.
//
// Set the RBAC Policy for a specific Organization within your Stytch Project. An Organization RBAC Policy
// allows you to define roles that are specific to that organization, providing fine-grained control over
// permissions at the organization level.
//
// This endpoint allows you to create, update, or replace the organization-scoped roles for a given
// organization. Organization policies supplement the project-level RBAC policy with additional roles that
// are only applicable within the context of that specific organization.
//
// The organization policy consists of roles, where each role defines:
// - A unique `role_id` to identify the role
// - A human-readable `description` of the role's purpose
// - A set of `permissions` that specify which actions can be performed on which resources
//
// When you set an organization policy, it will replace any existing organization-specific roles for that
// organization. The project-level RBAC policy remains unchanged.
//
// Organization-specific roles are useful for scenarios where different organizations within your project
// require different permission structures, such as:
// - Multi-tenant applications with varying access levels per tenant
// - Organizations with custom approval workflows
// - Different organizational hierarchies requiring unique role definitions
//
// Check out the [RBAC overview](https://stytch.com/docs/b2b/guides/rbac/overview) to learn more about
// Stytch's RBAC permissioning model and organization-scoped policies.
func (c *RBACOrganizationsClient) SetOrgPolicy(
	ctx context.Context,
	body *organizations.SetOrgPolicyParams,
) (*organizations.SetOrgPolicyResponse, error) {
	var jsonBody []byte
	var err error
	if body != nil {
		jsonBody, err = json.Marshal(body)
		if err != nil {
			return nil, stytcherror.NewClientLibraryError("error marshaling request body")
		}
	}

	headers := make(map[string][]string)

	var retVal organizations.SetOrgPolicyResponse
	err = c.C.NewRequest(
		ctx,
		stytch.RequestParams{
			Method:      "PUT",
			Path:        fmt.Sprintf("/v1/b2b/rbac/organizations/%s", url.PathEscape(body.OrganizationID)),
			QueryParams: nil,
			Body:        jsonBody,
			V:           &retVal,
			Headers:     headers,
		},
	)
	return &retVal, err
}
